---
title: "ADR-0005 Supabase ローカル環境: CLI vs Docker Compose"
description: "Supabase ローカル開発環境の管理方式として CLI を採用した意思決定記録"
---

## ステータス
- **Accepted**（2026-02-24）

## コンテキスト
OpsHub の初期設計では、Supabase ローカル環境を `docker-compose.yml` による手動管理で構築する方針だった（[旧 Supabase 構成ドキュメント](../../architecture/supabase/) 参照）。
しかし実装フェーズに入り、以下の課題が顕在化した：

1. **手動 docker-compose.yml の保守負担** — Supabase は多数のサービス（Kong, GoTrue, PostgREST, Realtime, Storage, Studio, pg_meta, PostgreSQL, Inbucket）で構成されており、各イメージのバージョン追従・設定変更を手動管理するコストが高い
2. **マイグレーション管理のギャップ** — docker-compose.yml 方式ではマイグレーションの適用・差分取得・リセットに別途スクリプトが必要
3. **型生成の統合** — TypeScript 型の自動生成を開発フローに組み込む際、CLI のネイティブサポートが有利
4. **公式推奨の変遷** — Supabase 公式がローカル開発に CLI を推奨する方向に移行

## 選択肢

### 案A: Supabase CLI（`npx supabase start`）（採用）
- `npx supabase start` で全サービスを一括起動
- Docker コンテナの構成・ネットワーク・ボリュームを CLI が自動管理
- `supabase/config.toml` で設定を集約
- マイグレーション（`supabase db reset`, `supabase db diff`）、型生成（`supabase gen types`）が CLI ネイティブ

### 案B: 手動 Docker Compose 管理（却下）
- `docker-compose.yml` で各サービスを個別定義
- `docker compose up -d` で起動
- マイグレーションは `supabase/migrations/` + 自前スクリプト or `db push` で適用
- サービスイメージのバージョン・環境変数を手動管理

## 決定
- **採用**: 案A（Supabase CLI）
- **採用理由**:
  1. **マイグレーション管理が CLI ネイティブ** — `supabase db reset`（全リセット＋再適用）、`supabase db diff`（スキーマ差分の自動検出）により、マイグレーションのワークフローが標準化される
  2. **型生成が CLI ネイティブ** — `supabase gen types typescript --local > src/types/database.ts` でスキーマから TypeScript 型を直接生成でき、型安全な開発を維持できる
  3. **Docker コンテナの構成を CLI が自動管理** — サービス間の依存関係・ネットワーク設定・ヘルスチェックを CLI が内部的に処理するため、手動 `docker-compose.yml` が不要
  4. **docker-compose.yml のバージョン追従が不要** — Supabase のアップデート時に CLI を更新するだけで、各サービスイメージの互換性が保証される

## 影響
- **正の影響**:
  - 開発者のセットアップ手順が `npx supabase start` に統一され、オンボーディングが簡素化
  - マイグレーション・型生成・シード投入が一貫した CLI コマンドで完結
  - Supabase バージョンアップ時の追従コストが大幅に削減
- **負の影響**:
  - Supabase CLI 自体への依存（CLI のバグや仕様変更の影響を受ける）
  - Docker Compose レベルのカスタマイズ（カスタムサービス追加等）が制限される
  - CLI が内部的に使用する Docker 構成のデバッグが困難になる場合がある
- **移行/ロールバック**:
  - 旧 `docker-compose.yml` 方式への戻しは可能（`supabase/config.toml` の設定を `docker-compose.yml` に変換）
  - マイグレーションファイル（`supabase/migrations/`）はどちらの方式でも互換性あり

## 結果
- `docker-compose.yml`（Supabase 管理用）はリポジトリから不要となった
- ローカル環境は `supabase/config.toml` + `supabase/migrations/` で管理
- セットアップ手順は [環境構築ガイド](../../detail/setup/) に反映済み

## Related
- [旧 Supabase 構成](../../architecture/supabase/)（Archive） / [環境構築ガイド](../../detail/setup/) / ADR-0001（RBAC/RLS 方式）
