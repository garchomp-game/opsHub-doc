---
title: "ç›£æŸ»02: ä»•æ§˜æ›¸ã¨å®Ÿè£…ã®æ•´åˆæ€§"
---

## æ¦‚è¦

ä»•æ§˜æ›¸ï¼ˆç”»é¢ä»•æ§˜ SCR-xxx / APIä»•æ§˜ API-xxxï¼‰ã¨å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆ`OpsHub/src/`ï¼‰ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã—ãŸã€‚
å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: ç”»é¢ä»•æ§˜ 15ä»¶ã€APIä»•æ§˜ 11ä»¶ã€å®Ÿè£…ã‚³ãƒ¼ãƒ‰ 39ãƒ•ã‚¡ã‚¤ãƒ«ã€‚

**ä¸»ãªçŸ¥è¦‹**:
- å®Ÿè£…æ¸ˆã¿ãƒ»ä»•æ§˜æ•´åˆã®æ©Ÿèƒ½ãŒå¤šã„ï¼ˆç‰¹ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ç›£æŸ»ãƒ­ã‚°ã€çµŒè²»ã€é€šçŸ¥ï¼‰
- ãƒ‰ãƒ©ãƒ•ãƒˆçŠ¶æ…‹ã®ä»•æ§˜ï¼ˆSCR-B01ã€œB03, C01-1, C01-2, C02, C03-1, C03-2ï¼‰ã¯æ¦‚ç•¥ãƒ¬ãƒ™ãƒ«ã®è¨˜è¼‰ã§ã‚ã‚Šã€å®Ÿè£…ã¨ã®ç²¾å¯†æ¯”è¼ƒã¯é™å®šçš„
- é€†å¼•ãä½œæˆã—ãŸä»•æ§˜ï¼ˆSCR-D01, API-D01, SCR-E01, API-E01, SCR-A03ï¼‰ã¯å®Ÿè£…ã¨ã®ä¸€è‡´åº¦ãŒéå¸¸ã«é«˜ã„

---

## ç”»é¢ä»•æ§˜ vs å®Ÿè£…

### SCR-001 ãƒ­ã‚°ã‚¤ãƒ³ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/login` â€” å®Ÿè£…ã¯ `(authenticated)` å¤–ã®ãŸã‚ç›´æ¥å¯¾è±¡å¤–ã ãŒã€`requireAuth()` ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã¨ã—ã¦æ©Ÿèƒ½ |
| èªè¨¼ãƒ•ãƒ­ãƒ¼ | âœ… | Supabase Auth `signInWithPassword` â€” ä»•æ§˜é€šã‚Š |
| æ¨©é™ãƒã‚§ãƒƒã‚¯ | âœ… | æœªèªè¨¼â†’ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã€èªè¨¼æ¸ˆã¿â†’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â€” `requireAuth()` ã§å®Ÿè£… |

> **å‚™è€ƒ**: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è‡ªä½“ã¯ `(authenticated)` ãƒ«ãƒ¼ãƒˆå¤–ã®ãŸã‚å®Ÿè£…ã‚³ãƒ¼ãƒ‰å¯¾è±¡å¤–ã€‚ä»•æ§˜ã®æ–¹å‘æ€§ã¨ `requireAuth()` ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã¯ä¸€è‡´ã€‚

---

### SCR-002 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ âœ…ï¼ˆè»½å¾®ãªå·®åˆ†ã‚ã‚Šï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/`ï¼ˆèªè¨¼æ¸ˆã¿ãƒ«ãƒ¼ãƒˆï¼‰â€” `page.tsx` |
| KPIã‚«ãƒ¼ãƒ‰ï¼ˆ4æšï¼‰ | âœ… | è‡ªåˆ†ã®ç”³è«‹ / æœªå‡¦ç†ã®ç”³è«‹ / æ‹…å½“ã‚¿ã‚¹ã‚¯ / ä»Šé€±ã®å·¥æ•° â€” å…¨ã¦å®Ÿè£… |
| ãƒ­ãƒ¼ãƒ«åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ | âœ… | `isApprover`, `isMemberOrPm`, `isPm` â€” ä»•æ§˜é€šã‚Š |
| KPIã‚«ãƒ¼ãƒ‰ ã‚¢ã‚¤ã‚³ãƒ³ | âœ… | `FileTextOutlined`, `CheckCircleOutlined`, `ProjectOutlined`, `ClockCircleOutlined` â€” ä¸€è‡´ |
| æœªå‡¦ç†ã®ç”³è«‹ èµ¤æ–‡å­— | âœ… | `valueStyle={pendingApprovals > 0 ? { color: "#cf1322" } : undefined}` â€” ä¸€è‡´ |
| ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– | âœ… | `xs={24} sm={12} lg={6}` â€” ä¸€è‡´ |
| Promise.all ä¸¦è¡Œå–å¾— | âœ… | 6ã¤ã®é–¢æ•°ã‚’ä¸¦åˆ—å®Ÿè¡Œ â€” ä»•æ§˜è¨˜è¼‰ã®ã‚³ãƒ¼ãƒ‰ã¨å®Œå…¨ä¸€è‡´ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ï¼ˆPMï¼‰ | âœ… | `pm_id`, `status IN ('planning','active')` â€” ä¸€è‡´ |
| é€šçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | âœ… | æœªèª­5ä»¶ã€Empty ã¯ `PRESENTED_IMAGE_SIMPLE` â€” ä¸€è‡´ |
| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | âœ… | 3ãƒœã‚¿ãƒ³ `/workflows/new`, `/timesheets`, `/projects` â€” ä¸€è‡´ |
| é€šçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | âœ… | `Col xs={24} lg={14}` / `Col xs={24} lg={10}` â€” ä¸€è‡´ |
| é€šçŸ¥ãƒªãƒ³ã‚¯ç”Ÿæˆ | âš ï¸ | **ä»•æ§˜ã¨å®Ÿè£…ã«å·®åˆ†ã‚ã‚Š**ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |

> âš ï¸ **å·®åˆ†: é€šçŸ¥ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ«ãƒ¼ãƒ«ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ `page.tsx` å†…ã® `getNotificationHref`ï¼‰**
>
> | resource_type | ä»•æ§˜ (SCR-002 / SCR-E01) | å®Ÿè£… (`page.tsx` L31-36) | åˆ¤å®š |
> |---|---|---|---|
> | `task` | `/tasks/{id}` (SCR-002 L92), `/projects` (SCR-E01 L142) | `/tasks/${resource_id}` | âš ï¸ |
> | `expense` | `/expenses/{id}` (SCR-002 L92), `/expenses` (SCR-E01 L143) | `/expenses/${resource_id}` | âš ï¸ |
>
> - SCR-002 ã®é€šçŸ¥ãƒªãƒ³ã‚¯å®šç¾©ã¯ `task â†’ /tasks/{id}`, `expense â†’ /expenses/{id}` ã ãŒã€**SCR-E01 ï¼ˆé€šçŸ¥ã®æ­£å¼ä»•æ§˜ï¼‰** ã§ã¯ `task â†’ /projects`, `expense â†’ /expenses`ï¼ˆIDãªã—ï¼‰ã¨å®šç¾©ã€‚
> - **`page.tsx` å†…** ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã¯ SCR-002 ã®å¤ã„å®šç¾©ã«å¾“ã£ã¦ã„ã‚‹ã€‚
> - **`lib/notifications.ts` ã® `getNotificationLink`**ï¼ˆNotificationBell ç”¨ï¼‰ã¯ SCR-E01 ã«æº–æ‹ æ¸ˆã¿ã€‚
> - **åˆ¤æ–­**: **ä»•æ§˜ãŒå¤ã„ï¼ˆSCR-002 ã®ãƒªãƒ³ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**ã€‚SCR-002 å´ã‚’ SCR-E01 ã«åˆã‚ã›ã‚‹ã¹ãã€‚
> - **å®Ÿè£…(`page.tsx`)ã‚‚ä¿®æ­£æ¨å¥¨**: SCR-E01 ã«åˆã‚ã›ã¦ `task â†’ /projects`, `expense â†’ /expenses` ã¨ã™ã¹ãã€‚

---

### SCR-A01 ãƒ†ãƒŠãƒ³ãƒˆç®¡ç† âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/admin/tenant` â€” å®Ÿè£…ä¸€è‡´ |
| æ¨©é™ãƒã‚§ãƒƒã‚¯ | âœ… | `hasRole(user, tenantId, ["it_admin"])` / `hasRole(user, tenantId, ["tenant_admin"])` ã§äºŒé‡ãƒã‚§ãƒƒã‚¯ |
| Tenant Admin/IT Admin ã®ã¿ | âœ… | ä»•æ§˜ã®æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ã¨ä¸€è‡´ |

---

### SCR-A02 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/admin/users` â€” å®Ÿè£…ä¸€è‡´ |
| æ¨©é™ãƒã‚§ãƒƒã‚¯ | âœ… | IT Admin / Tenant Admin ã®ã¿ â€” ä¸€è‡´ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ | âœ… | `UserManagement` Client Component ã§å®Ÿè£… |
| æ‹›å¾…ãƒ•ãƒ­ãƒ¼ | âœ… | `InviteModal` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å­˜åœ¨ |

---

### SCR-A03 ç›£æŸ»ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢ âœ…ï¼ˆé‡ç‚¹ãƒã‚§ãƒƒã‚¯å¯¾è±¡ï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/admin/audit-logs` â€” ä¸€è‡´ |
| å¯¾è±¡ãƒ­ãƒ¼ãƒ« | âœ… | `hasRole(user, tenantId, ["it_admin", "tenant_admin"])` â€” ä¸€è‡´ |
| ãƒ˜ãƒƒãƒ€ | âœ… | `Title level={3}` ã€Œç›£æŸ»ãƒ­ã‚°ã€ â€” ä¸€è‡´ |
| ãƒ•ã‚£ãƒ«ã‚¿ã‚«ãƒ¼ãƒ‰ | âœ… | `Card size="small"`, `FilterOutlined + "ãƒ•ã‚£ãƒ«ã‚¿"`, `ClearOutlined` ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ â€” ä¸€è‡´ |
| ãƒ•ã‚£ãƒ«ã‚¿ 4é …ç›® | âœ… | æœŸé–“(RangePicker) / ãƒ¦ãƒ¼ã‚¶ãƒ¼(Select) / ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥(Select) / ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥(Select) â€” ä¸€è‡´ |
| ãƒ•ã‚£ãƒ«ã‚¿ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– | âœ… | `xs={24} sm={12} md={6}` â€” ä¸€è‡´ |
| ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—å®šç¾© | âœ… | æ—¥æ™‚(180px) / æ“ä½œè€…(200px, Copyable) / ã‚¢ã‚¯ã‚·ãƒ§ãƒ³(160px, Tagè‰²ä»˜ã) / ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥(140px) / ãƒªã‚½ãƒ¼ã‚¹ID(200px, Copyable) â€” ä¸€è‡´ |
| ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ50ä»¶ã€é¸æŠè‚¢ 10/20/50/100ã€`showSizeChanger`, `å…¨ {total} ä»¶` â€” ä¸€è‡´ |
| ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | `range(from, to)` æ–¹å¼ â€” ä¸€è‡´ |
| å±•é–‹è¡Œï¼ˆExpandableï¼‰ | âœ… | `before_data`/`after_data` ã®å·®åˆ†è¡¨ç¤ºã€èµ¤ç³»`#fff1f0`/ç·‘ç³»`#f6ffed`ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç°è‰²ã€å·®åˆ†ã‚­ãƒ¼æŠ½å‡º â€” ä¸€è‡´ |
| å±•é–‹æ¡ä»¶ | âœ… | `rowExpandable: (record) => !!(record.before_data \|\| record.after_data \|\| record.metadata)` â€” ä¸€è‡´ |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ãƒ©ãƒ™ãƒ«(21ç¨®) | âš ï¸ | **ä»•æ§˜23ç¨® vs å®Ÿè£…21ç¨®**ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |
| ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥ãƒ©ãƒ™ãƒ«(7ç¨®) | âœ… | 7ç¨®ã™ã¹ã¦ä¸€è‡´ |
| ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | âœ… | ã€Œãƒ†ãƒŠãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ã€Œã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚Šã¾ã›ã‚“ã€ã€Œè©²å½“ã™ã‚‹ç›£æŸ»ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“ã€ â€” ä¸€è‡´ |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | âœ… | `ERR-AUTH-002`, `ERR-AUTH-003`, `ERR-SYS-001` â€” ä¸€è‡´ |

> âš ï¸ **å·®åˆ†: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ãƒ©ãƒ™ãƒ«æ•°**
>
> ä»•æ§˜(SCR-A03)ã¯ **23ç¨®**ï¼ˆ`expense.create`, `expense.submit` ã‚’å«ã‚€ï¼‰ã ãŒã€å®Ÿè£…ã® `ACTION_LABELS` å®šæ•°ã¯ **21ç¨®**ã€‚
>
> | ä»•æ§˜ã«ã‚ã£ã¦å®Ÿè£…ã«ãªã„ã‚‚ã® | ç†ç”± |
> |---|---|
> | `expense.create` | çµŒè²»æ©Ÿèƒ½ã¯å¾Œã‹ã‚‰è¿½åŠ ã€‚`_actions.ts` ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šæ•°ãƒªã‚¹ãƒˆã«æœªè¿½åŠ  |
> | `expense.submit` | åŒä¸Š |
>
> - **åˆ¤æ–­**: **å®Ÿè£…ãŒä¸è¶³**ã€‚`AuditLogViewer.tsx` ã® `ACTION_LABELS` ã¨ `_actions.ts` ã® `actionTypes` ã« `expense.create` / `expense.submit` ã‚’è¿½åŠ ã™ã¹ãã€‚

---

### SCR-B01 ç”³è«‹ä¸€è¦§ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/workflows` â€” ä¸€è‡´ |
| ãƒ†ãƒ¼ãƒ–ãƒ«åˆ— | âœ… | ç”³è«‹ç•ªå· / ç¨®åˆ¥ / ã‚¿ã‚¤ãƒˆãƒ« / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ / é‡‘é¡ / ç”³è«‹æ—¥ â€” ä¸€è‡´ï¼ˆä»•æ§˜ã®ã€Œç”³è«‹è€…ã€åˆ—ã¯æœªè¨˜è¼‰ã ãŒã€`created_by = user.id` ãƒ•ã‚£ãƒ«ã‚¿ã§è‡ªåˆ†ã®ç”³è«‹ã®ã¿è¡¨ç¤ºï¼‰ |
| ãƒ•ã‚£ãƒ«ã‚¿ | âœ… | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿å®Ÿè£…æ¸ˆã¿ |
| ã‚½ãƒ¼ãƒˆ | âœ… | `created_at DESC` â€” ä¸€è‡´ |
| ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | 20ä»¶/ãƒšãƒ¼ã‚¸ â€” ä¸€è‡´ |
| æ–°è¦ç”³è«‹ãƒœã‚¿ãƒ³ | âœ… | `/workflows/new` â€” ä¸€è‡´ |
| ã‚¿ãƒ–ï¼ˆè‡ªåˆ†ã®ç”³è«‹ / æ‰¿èªå¾…ã¡ï¼‰ | âš ï¸ | ã‚¿ãƒ–å½¢å¼ã§ã¯ãªãã€`/workflows`ï¼ˆè‡ªåˆ†ã®ç”³è«‹ï¼‰ã¨ `/workflows/pending`ï¼ˆæ‰¿èªå¾…ã¡ï¼‰ã§åˆ¥ãƒšãƒ¼ã‚¸ã«åˆ†é›¢ |

> âš ï¸ **å·®åˆ†: ã‚¿ãƒ–æ§‹æˆ**
> - ä»•æ§˜: ã€Œè‡ªåˆ†ã®ç”³è«‹ã€/ã€Œæ‰¿èªå¾…ã¡ã€ã‚’ã‚¿ãƒ–ã§åˆ‡æ›¿
> - å®Ÿè£…: `/workflows`ï¼ˆè‡ªåˆ†ã®ç”³è«‹ï¼‰ã¨ `/workflows/pending`ï¼ˆæ‰¿èªå¾…ã¡ï¼‰ã‚’åˆ¥ãƒšãƒ¼ã‚¸ã¨ã—ã¦å®Ÿè£…ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§åˆ‡æ›¿
> - **åˆ¤æ–­**: **ä»•æ§˜ãŒå¤ã„**ã€‚åˆ¥ãƒšãƒ¼ã‚¸æ–¹å¼ã®æ–¹ãŒURLã®æ„å‘³ãŒæ˜ç¢ºã§ã‚ã‚Šã€å®Ÿè£…ã®æ–¹ãŒé©åˆ‡ã€‚ä»•æ§˜å´ã‚’æ›´æ–°æ¨å¥¨ã€‚

---

### SCR-B02 ç”³è«‹ä½œæˆ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/workflows/new` â€” ä¸€è‡´ |
| å¯¾è±¡ãƒ­ãƒ¼ãƒ« | âœ… | ä»•æ§˜ã€ŒMember, PM, Accountingã€â€” å®Ÿè£…ã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡ãŒã‚¢ã‚¯ã‚»ã‚¹å¯ï¼ˆRLS ã§åˆ¶å¾¡ï¼‰ |
| ãƒ•ã‚©ãƒ¼ãƒ é …ç›® | âœ… | ç¨®åˆ¥ / ã‚¿ã‚¤ãƒˆãƒ« / èª¬æ˜ / é‡‘é¡ / æœŸé–“ / æ‰¿èªè€… â€” å®Ÿè£…ä¸€è‡´ |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ | âœ… | ã€Œä¸‹æ›¸ãä¿å­˜ã€/ã€Œé€ä¿¡ã€ â€” ä¸€è‡´ |

---

### SCR-B03 ç”³è«‹è©³ç´°/æ‰¿èª âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/workflows/[id]` â€” ä¸€è‡´ |
| æ‰¿èª/å·®æˆ»ã—/å–ä¸‹ã’ | âœ… | `approveWorkflow` / `rejectWorkflow` / `transitionWorkflow` (withdraw) â€” å®Ÿè£…æ¸ˆã¿ |
| å·®æˆ»ã—ç†ç”±ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ | âœ… | `input.reason.trim().length === 0` ã§æ¤œè¨¼ â€” ä¸€è‡´ |
| é€šçŸ¥é€ä¿¡ | âœ… | æ‰¿èªæ™‚ `workflow_approved`ã€å·®æˆ»ã—æ™‚ `workflow_rejected` â€” ä¸€è‡´ |

---

### SCR-C01-1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/projects` â€” ä¸€è‡´ |
| ãƒ†ãƒ¼ãƒ–ãƒ«åˆ— | âœ… | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ / ãƒ¡ãƒ³ãƒãƒ¼æ•° / é–‹å§‹æ—¥ / çµ‚äº†æ—¥ / ä½œæˆæ—¥ â€” ä¸€è‡´ |
| ãƒ•ã‚£ãƒ«ã‚¿ | âœ… | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ + ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ â€” ä¸€è‡´ |
| ã‚½ãƒ¼ãƒˆ | âœ… | `created_at DESC` â€” ä¸€è‡´ |
| æ–°è¦ä½œæˆãƒœã‚¿ãƒ³ | âœ… | PM / Tenant Admin ã®ã¿ `canCreate = hasRole(user, tenantId, ["pm", "tenant_admin"])` â€” ä¸€è‡´ |
| è¡Œã‚¯ãƒªãƒƒã‚¯é·ç§» | âœ… | `/projects/[id]` â€” ä¸€è‡´ |

> **å‚™è€ƒ**: ä»•æ§˜ã®ã€Œé€²æ—ã€åˆ—ã¯å®Ÿè£…ãƒ†ãƒ¼ãƒ–ãƒ«ã«å«ã¾ã‚Œã¦ã„ãªã„ï¼ˆä»•æ§˜ã¯ Draft çŠ¶æ…‹ï¼‰ã€‚PMåˆ—ã‚‚æœªå®Ÿè£…ã€‚

---

### SCR-C01-2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´° âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/projects/[id]` â€” ä¸€è‡´ |
| ã‚¿ãƒ–æ§‹æˆ | âœ… | `ProjectDetailClient` ã§æ¦‚è¦ / ã‚¿ã‚¹ã‚¯ /  ãƒ¡ãƒ³ãƒãƒ¼ç­‰ã‚’è¡¨ç¤º |
| ç·¨é›†æ¨©é™ | âœ… | PM / Tenant Admin â€” å®Ÿè£…ä¸€è‡´ |

---

### SCR-C02 ã‚¿ã‚¹ã‚¯ç®¡ç† âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/projects/[id]/tasks` â€” ä¸€è‡´ |
| ã‚«ãƒ³ãƒãƒ³ãƒœãƒ¼ãƒ‰ | âœ… | `KanbanBoard` Client Component ã§å®Ÿè£… |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾© | âœ… | `todo` / `in_progress` / `done` â€” ä¸€è‡´ |
| Server Actions | âœ… | `projects/[id]/tasks/_actions.ts` ã« CRUD å®Ÿè£… |

---

### SCR-C03-1 å·¥æ•°å…¥åŠ› âš ï¸

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âš ï¸ | **ä»•æ§˜ `/timesheet`** vs **å®Ÿè£… `/timesheets`** |
| é€±ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ | âœ… | `WeeklyTimesheetClient` ã§ Monã€œSun ã‚°ãƒªãƒƒãƒ‰å®Ÿè£… |
| å¯¾è±¡ãƒ­ãƒ¼ãƒ« | âœ… | Member, PM â€” èªè¨¼æ¸ˆã¿å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹å¯ï¼ˆRLS ã§è‡ªåˆ†ã®å·¥æ•°ã®ã¿ï¼‰ |

> âš ï¸ **å·®åˆ†: URL**
> - ä»•æ§˜: `/timesheet`ï¼ˆå˜æ•°å½¢ï¼‰
> - å®Ÿè£…: `/timesheets`ï¼ˆè¤‡æ•°å½¢ï¼‰
> - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒªãƒ³ã‚¯ã‚‚ `/timesheets`
> - **åˆ¤æ–­**: **ä»•æ§˜ãŒå¤ã„**ã€‚å®Ÿè£…ã®è¤‡æ•°å½¢ `/timesheets` ã«åˆã‚ã›ã¦ä»•æ§˜ã‚’ä¿®æ­£æ¨å¥¨ã€‚

---

### SCR-C03-2 å·¥æ•°é›†è¨ˆ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URL | âœ… | `/timesheets/reports` â€” å®Ÿè£…ä¸€è‡´ |
| é›†è¨ˆãƒ“ãƒ¥ãƒ¼ | âœ… | `ReportClient` ã§ PJåˆ¥ / ãƒ¡ãƒ³ãƒãƒ¼åˆ¥é›†è¨ˆã‚’å®Ÿè£… |
| ãƒ•ã‚£ãƒ«ã‚¿ | âœ… | æœŸé–“ / ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â€” å®Ÿè£…æ¸ˆã¿ |

---

### SCR-D01 çµŒè²»ç®¡ç† âœ…ï¼ˆé‡ç‚¹ãƒã‚§ãƒƒã‚¯å¯¾è±¡ï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| URLï¼ˆä¸€è¦§ï¼‰ | âœ… | `/expenses` â€” ä¸€è‡´ |
| URLï¼ˆæ–°è¦ï¼‰ | âœ… | `/expenses/new` â€” ä¸€è‡´ |
| ãƒ­ãƒ¼ãƒ«åˆ¥è¡¨ç¤º | âœ… | Accounting/TenantAdmin â†’ å…¨ä»¶ã€ãã®ä»– â†’ `created_by = user.id` â€” ä¸€è‡´ |
| ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ï¼ˆ9åˆ—ï¼‰ | âš ï¸ | ç”³è«‹è€…åˆ—ã® profiles JOIN ãŒä¸€è¦§ãƒšãƒ¼ã‚¸ã§ä¸è¶³ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |
| ã‚«ãƒ†ã‚´ãƒªè‰²å®šç¾© | âœ… | 6è‰²å…¨ã¦ä¸€è‡´ |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²å®šç¾© | âœ… | 5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å…¨ã¦ä¸€è‡´ |
| ãƒ•ã‚£ãƒ«ã‚¿ | âœ… | ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ â€” ä¸€è‡´ |
| ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | 20ä»¶/ãƒšãƒ¼ã‚¸ã€`å…¨ XX ä»¶` â€” ä¸€è‡´ |
| çµŒè²»ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ  | âœ… | æ—¥ä»˜/ã‚«ãƒ†ã‚´ãƒª/é‡‘é¡/ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/èª¬æ˜/æ‰¿èªè€… â€” å…¨é …ç›®ä¸€è‡´ |
| æ‰¿èªè€…è¡¨ç¤ºå½¢å¼ | âœ… | `{display_name}ï¼ˆ{ãƒ­ãƒ¼ãƒ«ãƒ©ãƒ™ãƒ«}ï¼‰` â€” ä¸€è‡´ |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ | âœ… | ä¸‹æ›¸ãä¿å­˜ / é€ä¿¡ / ã‚­ãƒ£ãƒ³ã‚»ãƒ« â€” ä¸€è‡´ |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€£å‹• | âœ… | `next_workflow_number` RPC â†’ workflows INSERT â†’ expenses INSERT â†’ ç›£æŸ»ãƒ­ã‚° â†’ `revalidatePath` â€” ä¸€è‡´ |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«å½¢å¼ | âœ… | `çµŒè²»ç”³è«‹: {category} Â¥{amount}` â€” ä¸€è‡´ |

> âš ï¸ **å·®åˆ†: ä¸€è¦§ãƒšãƒ¼ã‚¸ã® profiles JOIN**
>
> - ä»•æ§˜ (SCR-D01): 9åˆ—ç›®ã«ã€Œç”³è«‹è€…ã€åˆ—ï¼ˆ`profiles.display_name`ï¼‰
> - å®Ÿè£… (`expenses/page.tsx` L42-45): SELECT ã« `profiles!expenses_created_by_fkey` ãŒ **å«ã¾ã‚Œã¦ã„ãªã„**
> - ãŸã ã— UI ã® columns å®šç¾© (L127-131) ã§ã¯ `record.profiles?.display_name` ã‚’å‚ç…§ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹
> - **Server Action** (`_actions.ts` ã® `getExpenses`) ã§ã¯ profiles JOIN ãŒ**å«ã¾ã‚Œã¦ã„ã‚‹**
> - **åˆ¤æ–­**: **å®Ÿè£…ã®ä¸æ•´åˆ**ã€‚ä¸€è¦§ãƒšãƒ¼ã‚¸ (`page.tsx`) ã¯ç›´æ¥ã‚¯ã‚¨ãƒªã—ã¦ãŠã‚Š Server Action ã‚’ä½¿ã£ã¦ã„ãªã„ãŸã‚ã€profiles JOIN ãŒæ¬ è½ã€‚Server Action çµŒç”±ã«çµ±ä¸€ã™ã‚‹ã‹ã€ç›´æ¥ã‚¯ã‚¨ãƒªã« `profiles!expenses_created_by_fkey ( display_name )` ã‚’è¿½åŠ ã™ã¹ãã€‚

---

### SCR-E01 é€šçŸ¥ âœ…ï¼ˆé‡ç‚¹ãƒã‚§ãƒƒã‚¯å¯¾è±¡ï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| é…ç½®å ´æ‰€ | âœ… | `layout.tsx` ã®ãƒ˜ãƒƒãƒ€ãƒ¼å³ä¸Š â€” ä¸€è‡´ |
| ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ | âœ… | `BellOutlined`, `Badge`, `Tooltip` â€” ä¸€è‡´ |
| Popover | âœ… | 360px, `bottomRight`, `arrow={false}`, `trigger="click"` â€” ä¸€è‡´ |
| é€šçŸ¥ãƒªã‚¹ãƒˆ | âœ… | `List`, maxHeight 400px, æœ€å¤§20ä»¶ â€” ä¸€è‡´ |
| ç©ºçŠ¶æ…‹ | âœ… | `Empty PRESENTED_IMAGE_SIMPLE`, ã€Œé€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“ã€ â€” ä¸€è‡´ |
| ã€Œã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹ã€ | âœ… | `Button type="link"`, `CheckOutlined`, æœªèª­1ä»¶ä»¥ä¸Šã§è¡¨ç¤º â€” ä¸€è‡´ |
| æœªèª­ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ | âœ… | `Badge status="processing"` â€” ä¸€è‡´ |
| ã‚¿ã‚¤ãƒˆãƒ« fontWeight | âœ… | æœªèª­ 600, æ—¢èª­ normal â€” ä¸€è‡´ |
| æœ¬æ–‡ ellipsis | âœ… | `Text type="secondary" ellipsis` â€” ä¸€è‡´ |
| èƒŒæ™¯è‰² | âœ… | æœªèª­ `rgba(22,119,255,0.04)` / æ—¢èª­ `transparent` â€” ä¸€è‡´ |
| ãƒ›ãƒãƒ¼ | âœ… | `rgba(0,0,0,0.04)` â€” ä¸€è‡´ |
| æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | âœ… | ãŸã£ãŸä»Š/nåˆ†å‰/næ™‚é–“å‰/næ—¥å‰/YYYY/MM/DD â€” ä¸€è‡´ |
| SSR ãƒ‘ã‚¿ãƒ¼ãƒ³ | âœ… | `layout.tsx` ã§ `Promise.all([getNotifications(), getUnreadCount()])` â†’ props â€” ä¸€è‡´ |
| Popover é–‹é–‰æ™‚ã®ãƒ‡ãƒ¼ã‚¿å†å–å¾— | âœ… | `useTransition` + `getNotifications` + `getUnreadCount` â€” ä¸€è‡´ |
| æ¥½è¦³çš„UIæ›´æ–° | âœ… | `markAsRead` / `markAllAsRead` å¾Œã«ãƒ­ãƒ¼ã‚«ãƒ« state ã‚’å³æ›´æ–° â€” ä¸€è‡´ |
| ãƒªã‚½ãƒ¼ã‚¹é·ç§»ãƒ«ãƒ¼ãƒ« | âœ… | `getNotificationLink` in `lib/notifications.ts` â€” SCR-E01 ã¨ä¸€è‡´ |

---

## APIä»•æ§˜ vs å®Ÿè£…

### API-A01 ãƒ†ãƒŠãƒ³ãƒˆç®¡ç† âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±å–å¾— | âœ… | `admin/tenant/page.tsx` ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å–å¾— |
| æ¨©é™ | âœ… | Tenant Admin / IT Admin ã®ã¿ |

> **å‚™è€ƒ**: API-A01 ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ›´æ–° / è¨­å®šå¤‰æ›´ / ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ / å‰Šé™¤ã¯é«˜åº¦ãªæ©Ÿèƒ½ã§ã‚ã‚Šã€MVP ç¯„å›²ã§ã®å®Ÿè£…ã¯éƒ¨åˆ†çš„ã€‚

---

### API-A02 ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…/ç®¡ç† âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾— | âœ… | `admin/users/_actions.ts` ã«å®Ÿè£… |
| æ‹›å¾… | âœ… | `InviteModal` + Server Action |
| ãƒ­ãƒ¼ãƒ«å¤‰æ›´ / ç„¡åŠ¹åŒ– | âœ… | `UserDetailPanel` + Server Actions |
| æ¨©é™ | âœ… | Tenant Admin / IT Admin ã®ã¿ |

---

### API-B01 ç”³è«‹ä¸€è¦§å–å¾— âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| ã‚¯ã‚¨ãƒªæ¡ä»¶ | âœ… | status ãƒ•ã‚£ãƒ«ã‚¿ã€`created_at DESC`ã€20ä»¶/ãƒšãƒ¼ã‚¸ |
| ã‚¿ãƒ–åˆ‡æ›¿ | âš ï¸ | `mode=mine/pending` â†’ `/workflows` / `/workflows/pending` ã«åˆ†é›¢ï¼ˆå‰è¿°ï¼‰ |
| RLS åˆ¶å¾¡ | âœ… | `created_by = user.id` / `approver_id = user.id AND status = 'submitted'` |

---

### API-B02 ç”³è«‹ä½œæˆ/æ›´æ–° âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| Server Action å | âœ… | `createWorkflow`, `updateWorkflow` â€” å®Ÿè£…æ¸ˆã¿ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | title å¿…é ˆ(200æ–‡å­—ä»¥å†…)ã€æ‰¿èªè€…å¿…é ˆã€æ—¥ä»˜ç¯„å›² â€” ä¸€è‡´ |
| å‡¦ç†ãƒ•ãƒ­ãƒ¼ | âœ… | èªè¨¼â†’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³â†’æ‰¿èªè€…æ¤œè¨¼â†’DB INSERTâ†’ç›£æŸ»ãƒ­ã‚°â†’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ– |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | âš ï¸ | ä»•æ§˜ `ERR-VAL-001`ã€œ`ERR-WF-001` â€” å®Ÿè£…ã¯ã‚³ãƒ¼ãƒ‰ä½“ç³»ãŒé¡ä¼¼ã ãŒã€ç•ªå·ãŒä¸€éƒ¨ç•°ãªã‚‹ |
| é€šçŸ¥ | âš ï¸ | ä»•æ§˜ã€Œsubmitæ™‚ã«æ‰¿èªè€…ã«é€šçŸ¥ã€â€” `createWorkflow` ã§ã¯ **é€šçŸ¥ä½œæˆãŒæœªå®Ÿè£…** |

> âš ï¸ **å·®åˆ†: createWorkflow é€ä¿¡æ™‚ã®é€šçŸ¥**
>
> - ä»•æ§˜ (API-B02): `action=submit ã®å ´åˆã€æ‰¿èªè€…ã«é€šçŸ¥ã‚’ä½œæˆ`
> - å®Ÿè£… (`createWorkflow`): ç›£æŸ»ãƒ­ã‚°ã¯æ›¸ãè¾¼ã‚€ãŒã€**é€šçŸ¥ä½œæˆ (`createNotification`) ã¯å‘¼ã³å‡ºã—ã¦ã„ãªã„**
> - `approveWorkflow` / `rejectWorkflow` ã§ã¯é€šçŸ¥ä½œæˆæ¸ˆã¿
> - **åˆ¤æ–­**: **å®Ÿè£…ãŒä¸è¶³**ã€‚`createWorkflow` ã§ `status === "submitted"` ã®å ´åˆã« `createNotification` ã‚’å‘¼ã³å‡ºã™ã¹ãã€‚

---

### API-B03 ç”³è«‹æ‰¿èª/å·®æˆ»ã— âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| Server Action å | âœ… | `approveWorkflow`, `rejectWorkflow`, `transitionWorkflow` (withdraw) |
| çŠ¶æ…‹é·ç§» | âœ… | `WORKFLOW_TRANSITIONS` å®šæ•°ã§ç®¡ç† â€” ä¸€è‡´ |
| æ¨©é™ãƒã‚§ãƒƒã‚¯ | âœ… | `approver_id = user.id` or `tenant_admin` â€” ä¸€è‡´ |
| å·®æˆ»ã—ç†ç”±å¿…é ˆ | âœ… | `ERR-WF-002` â€” ä¸€è‡´ |
| é€šçŸ¥ | âœ… | æ‰¿èªâ†’`workflow_approved`ã€å·®æˆ»ã—â†’`workflow_rejected` â€” ä¸€è‡´ |
| ç›£æŸ»ãƒ­ã‚° | âœ… | before/after ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€rejectæ™‚ reason ã‚’ metadata â€” ä¸€è‡´ |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | âœ… | `ERR-AUTH-001`, `ERR-AUTH-002`, `ERR-WF-001`ã€œ`003` â€” ä¸€è‡´ |

---

### API-C01 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆCRUD âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| ä¸€è¦§å–å¾— | âœ… | `projects/page.tsx` ã§ Server Component ç›´æ¥ã‚¯ã‚¨ãƒª |
| è©³ç´°å–å¾— | âœ… | `projects/[id]/page.tsx` |
| ä½œæˆ | âœ… | `projects/_actions.ts` ã« `createProject` |
| ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ /å‰Šé™¤ | âœ… | `_actions.ts` ã«å®Ÿè£… |

---

### API-C02 ã‚¿ã‚¹ã‚¯CRUD âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| ä¸€è¦§å–å¾— | âœ… | `projects/[id]/tasks/page.tsx` |
| CRUD | âœ… | `projects/[id]/tasks/_actions.ts` |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§» | âœ… | Server Action ã§é·ç§»ãƒã‚§ãƒƒã‚¯ |

---

### API-C03-1 å·¥æ•°å…¥åŠ›/æ›´æ–° âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| æ—¥æ¬¡/é€±æ¬¡å–å¾— | âœ… | `timesheets/page.tsx` ã§é€±æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾— |
| ç™»éŒ² / æ›´æ–° / å‰Šé™¤ | âœ… | `timesheets/_actions.ts` ã«å®Ÿè£… |

---

### API-C03-2 å·¥æ•°é›†è¨ˆ âœ…

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| PJåˆ¥/ãƒ¡ãƒ³ãƒãƒ¼åˆ¥é›†è¨ˆ | âœ… | `timesheets/reports/_actions.ts`, `ReportClient.tsx` |
| CSVå‡ºåŠ› | âŒ | **æœªå®Ÿè£…** â€” ä»•æ§˜ã¯ Route Handler `GET /api/timesheets/export` ã ãŒã€å¯¾å¿œã™ã‚‹ API ãƒ«ãƒ¼ãƒˆãªã— |

> âŒ **å·®åˆ†: CSVå‡ºåŠ›**
>
> - ä»•æ§˜ (API-C03-2-EXPORT): `GET /api/timesheets/export` Route Handler
> - å®Ÿè£…: è©²å½“ãƒ•ã‚¡ã‚¤ãƒ« (`src/app/api/timesheets/export/route.ts`) ãŒ **å­˜åœ¨ã—ãªã„**
> - **åˆ¤æ–­**: **æœªå®Ÿè£…æ©Ÿèƒ½**ã€‚ä»•æ§˜ã«è¨˜è¼‰ã¯ã‚ã‚‹ãŒã€åˆæœŸå®Ÿè£…ã‚¹ã‚³ãƒ¼ãƒ—ã«å«ã¾ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ã€‚æ˜ç¤ºçš„ã«ã€Œæœªå®Ÿè£…ã€ã¨ä»•æ§˜ã«è¨˜è¼‰ã™ã‚‹ã‹ã€Backlog ãƒã‚±ãƒƒãƒˆåŒ–æ¨å¥¨ã€‚

---

### API-D01 çµŒè²»ç®¡ç† âœ…ï¼ˆé‡ç‚¹ãƒã‚§ãƒƒã‚¯å¯¾è±¡ï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| Server Action å | âœ… | `createExpense`, `getExpenses`, `getExpenseById`, `getProjects`, `getApprovers` â€” 5ã¤å…¨ä¸€è‡´ |
| `createExpense` å…¥åŠ›å‹ | âœ… | `CreateExpenseInput` â€” å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è‡´ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | 9é …ç›®ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â€” ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨ã¦ä¸€è‡´ |
| å‡¦ç†ãƒ•ãƒ­ãƒ¼ | âœ… | èªè¨¼â†’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³â†’PJç¢ºèªâ†’æ‰¿èªè€…ç¢ºèªâ†’RPCæ¡ç•ªâ†’WF INSERTâ†’çµŒè²»INSERTâ†’ç›£æŸ»ãƒ­ã‚°â†’revalidatePath â€” ä¸€è‡´ |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è‡ªå‹•ä½œæˆ | âœ… | å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`workflow_number`, `type`, `title`, `amount`ç­‰ï¼‰ä¸€è‡´ |
| `getExpenses` ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ | âœ… | Accounting/TenantAdmin â†’ å…¨ä»¶ã€ãã‚Œä»¥å¤– â†’ `created_by = user.id` â€” ä¸€è‡´ |
| `getExpenses` SELECT ã‚«ãƒ©ãƒ  | âœ… | `expenses.*, projects(id,name), workflows(id,status,workflow_number), profiles!expenses_created_by_fkey(display_name)` â€” ä¸€è‡´ |
| `getExpenseById` æ¨©é™ | âœ… | ä½œæˆè€…æœ¬äºº or Accounting/TenantAdmin â€” ä¸€è‡´ |
| `getProjects` | âœ… | `status IN ('planning','active')`, `name` æ˜‡é † â€” ä¸€è‡´ |
| `getApprovers` | âœ… | `role IN ('approver','accounting','tenant_admin')`, profiles JOIN â€” ä¸€è‡´ |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³» | âœ… | `ERR-AUTH-003`, `ERR-VAL-001`ã€œ`005`, `ERR-EXP-001`, `ERR-SYS-001` â€” å…¨ä¸€è‡´ |
| ç›£æŸ»ãƒ­ã‚° | âœ… | `expense.create` / `expense.submit` â€” ä¸€è‡´ |

---

### API-E01 é€šçŸ¥API âœ…ï¼ˆé‡ç‚¹ãƒã‚§ãƒƒã‚¯å¯¾è±¡ï¼‰

| é …ç›® | åˆ¤å®š | è©³ç´° |
|---|---|---|
| `getNotifications` | âœ… | `_actions/notifications.ts` â€” `requireAuth()`, `user_id = auth.uid()`, `created_at DESC`, `limit(20)`, ã‚¨ãƒ©ãƒ¼æ™‚ç©ºé…åˆ— â€” å…¨ä¸€è‡´ |
| `getUnreadCount` | âœ… | `select("*", { count: "exact", head: true })`, `is_read = false`, ã‚¨ãƒ©ãƒ¼æ™‚ `0` â€” å…¨ä¸€è‡´ |
| `markAsRead` | âœ… | `update({ is_read: true })`, `id = notificationId AND user_id = auth.uid()` â€” ä¸€è‡´ |
| `markAllAsRead` | âœ… | `update({ is_read: true })`, `user_id = auth.uid() AND is_read = false` â€” ä¸€è‡´ |
| `createNotification` ãƒ˜ãƒ«ãƒ‘ãƒ¼ | âœ… | `lib/notifications.ts`, `notifications INSERT`, ã‚¨ãƒ©ãƒ¼æ™‚ `console.error`ï¼ˆä¾‹å¤–ã‚¹ãƒ­ãƒ¼ãªã—ï¼‰ â€” ä¸€è‡´ |
| `CreateNotificationInput` | âœ… | `tenantId`, `userId`, `type`, `title`, `body?`, `resourceType?`, `resourceId?` â€” å…¨ä¸€è‡´ |
| `getNotificationLink` | âœ… | `lib/notifications.ts`, ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ«ãƒ¼ãƒ« workflow/project/task/expense/null â€” ä¸€è‡´ |
| é€šçŸ¥ã‚¿ã‚¤ãƒ—ä¸€è¦§ | âœ… | 5ç¨®ï¼ˆ`workflow_submitted/approved/rejected`, `task_assigned`, `project_member_added`ï¼‰â€” å®Ÿè£…ã®å‘¼ã³å‡ºã—ç®‡æ‰€ã¨ä¸€è‡´ |
| ã‚¨ãƒ©ãƒ¼è¨­è¨ˆ | âœ… | å…¨é–¢æ•°ã®éè‡´å‘½çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆconsole.error / ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¿”å´ï¼‰ â€” ä¸€è‡´ |

---

## ã‚µãƒãƒªãƒ¼ãƒãƒˆãƒªã‚¯ã‚¹

### ç”»é¢ä»•æ§˜

| ç”»é¢ID | ç”»é¢å | åˆ¤å®š | ä¸»ãªå·®åˆ† |
|---|---|---|---|
| SCR-001 | ãƒ­ã‚°ã‚¤ãƒ³ | âœ… | â€” |
| SCR-002 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | âš ï¸ | é€šçŸ¥ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ«ãƒ¼ãƒ«ãŒ SCR-E01 ã¨ä¸æ•´åˆ |
| SCR-A01 | ãƒ†ãƒŠãƒ³ãƒˆç®¡ç† | âœ… | â€” |
| SCR-A02 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | âœ… | â€” |
| SCR-A03 | ç›£æŸ»ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢ | âš ï¸ | `expense.create`/`expense.submit` ãŒã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥å®šæ•°ã‹ã‚‰æ¬ è½ |
| SCR-B01 | ç”³è«‹ä¸€è¦§ | âš ï¸ | ã‚¿ãƒ–æ§‹æˆâ†’åˆ¥ãƒšãƒ¼ã‚¸ã«å¤‰æ›´ï¼ˆä»•æ§˜ãŒå¤ã„ï¼‰ |
| SCR-B02 | ç”³è«‹ä½œæˆ | âœ… | â€” |
| SCR-B03 | ç”³è«‹è©³ç´°/æ‰¿èª | âœ… | â€” |
| SCR-C01-1 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ | âœ… | PMåˆ—ãƒ»é€²æ—åˆ—ã¯æœªå®Ÿè£…ï¼ˆä»•æ§˜ Draftï¼‰ |
| SCR-C01-2 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´° | âœ… | â€” |
| SCR-C02 | ã‚¿ã‚¹ã‚¯ç®¡ç† | âœ… | â€” |
| SCR-C03-1 | å·¥æ•°å…¥åŠ› | âš ï¸ | URL: ä»•æ§˜ `/timesheet` vs å®Ÿè£… `/timesheets` |
| SCR-C03-2 | å·¥æ•°é›†è¨ˆ | âœ… | â€” |
| SCR-D01 | çµŒè²»ç®¡ç† | âš ï¸ | ä¸€è¦§ãƒšãƒ¼ã‚¸ã§ profiles JOIN æ¬ è½ï¼ˆç”³è«‹è€…åãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼‰ |
| SCR-E01 | é€šçŸ¥ | âœ… | â€” |

### APIä»•æ§˜

| API ID | APIå | åˆ¤å®š | ä¸»ãªå·®åˆ† |
|---|---|---|---|
| API-A01 | ãƒ†ãƒŠãƒ³ãƒˆç®¡ç† | âœ… | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/å‰Šé™¤ç­‰ã®é«˜åº¦æ©Ÿèƒ½ã¯æœªå®Ÿè£…ï¼ˆMVPå¤–ï¼‰ |
| API-A02 | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…/ç®¡ç† | âœ… | â€” |
| API-B01 | ç”³è«‹ä¸€è¦§å–å¾— | âœ… | â€” |
| API-B02 | ç”³è«‹ä½œæˆ/æ›´æ–° | âš ï¸ | `createWorkflow` é€ä¿¡æ™‚ã«æ‰¿èªè€…ã¸ã®é€šçŸ¥ãŒæœªå®Ÿè£… |
| API-B03 | ç”³è«‹æ‰¿èª/å·®æˆ»ã— | âœ… | â€” |
| API-C01 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆCRUD | âœ… | â€” |
| API-C02 | ã‚¿ã‚¹ã‚¯CRUD | âœ… | â€” |
| API-C03-1 | å·¥æ•°å…¥åŠ›/æ›´æ–° | âœ… | â€” |
| API-C03-2 | å·¥æ•°é›†è¨ˆ | âŒ | CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ Route Handler æœªå®Ÿè£… |
| API-D01 | çµŒè²»ç®¡ç† | âœ… | â€” |
| API-E01 | é€šçŸ¥API | âœ… | â€” |

---

## æ¤œå‡ºã—ãŸå•é¡Œã®å„ªå…ˆåº¦

### ğŸ”´ å¯¾å¿œæ¨å¥¨ï¼ˆå®Ÿè£…ä¸è¶³ï¼‰

| # | å¯¾è±¡ | å•é¡Œ | ç¨®åˆ¥ |
|---|---|---|---|
| 1 | API-B02 / `createWorkflow` | é€ä¿¡æ™‚ (`status=submitted`) ã«æ‰¿èªè€…ã¸ã®é€šçŸ¥ (`createNotification`) ãŒæœªå®Ÿè£… | å®Ÿè£…ãŒä¸è¶³ |
| 2 | SCR-A03 / `AuditLogViewer.tsx` | `expense.create` / `expense.submit` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ãŒ ACTION_LABELS ã¨ actionTypes ã«æœªè¿½åŠ  | å®Ÿè£…ãŒä¸è¶³ |
| 3 | SCR-D01 / `expenses/page.tsx` | ä¸€è¦§ãƒšãƒ¼ã‚¸ã® Supabase ã‚¯ã‚¨ãƒªã« `profiles!expenses_created_by_fkey` JOIN ãŒæ¬ è½ï¼ˆç”³è«‹è€…åãŒè¡¨ç¤ºä¸å¯ï¼‰ | å®Ÿè£…ãŒä¸è¶³ |

### ğŸŸ¡ ä»•æ§˜æ›´æ–°æ¨å¥¨

| # | å¯¾è±¡ | å•é¡Œ | ç¨®åˆ¥ |
|---|---|---|---|
| 4 | SCR-002 | é€šçŸ¥ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ«ãƒ¼ãƒ«ã® `task`/`expense` ãƒãƒƒãƒ”ãƒ³ã‚°ãŒ SCR-E01 ã¨ä¸ä¸€è‡´ | ä»•æ§˜ãŒå¤ã„ |
| 5 | SCR-002 / `page.tsx` | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å†…ã® `getNotificationHref` ãŒ SCR-E01 ã®é·ç§»ãƒ«ãƒ¼ãƒ«ã¨ä¸ä¸€è‡´ | å®Ÿè£…ã‚‚ä¿®æ­£æ¨å¥¨ |
| 6 | SCR-B01 | ã‚¿ãƒ–æ§‹æˆï¼ˆä»•æ§˜ï¼‰â†’ åˆ¥ãƒšãƒ¼ã‚¸æ§‹æˆï¼ˆå®Ÿè£…ï¼‰ã«å¤‰æ›´ | ä»•æ§˜ãŒå¤ã„ |
| 7 | SCR-C03-1 | URL: `/timesheet`ï¼ˆä»•æ§˜ï¼‰â†’ `/timesheets`ï¼ˆå®Ÿè£…ï¼‰ | ä»•æ§˜ãŒå¤ã„ |
| 8 | API-C03-2 | CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒæœªå®Ÿè£…ã€‚ä»•æ§˜ã«ã€Œæœªå®Ÿè£…ã€æ³¨è¨˜ã‚’è¿½åŠ æ¨å¥¨ | æœªå®Ÿè£…æ©Ÿèƒ½ |
