---
title: "監査05: 要件カバレッジとギャップ分析"
---

# 監査05: 要件カバレッジとギャップ分析

> **監査日**: 2026-02-24  
> **対象**: requirements/（全ファイル）、spec/（全ファイル）、logs/knowledge.md

---

## 1. 機能カバレッジマトリクス（REQ × 仕様書有無 × 実装有無）

### 凡例

| 記号 | 意味 |
|---|---|
| ✅ | 存在し、内容あり |
| ⚠️ | 部分的にカバー |
| ❌ | 存在しない |
| N/A | 該当なし（設計上不要） |

### Epic A: テナント/組織/権限（Must）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-A01 | テナント管理 | ✅ SCR-A01 | ✅ API-A01 | ✅ TICKET-02 完了 | **完全カバー** |
| REQ-A02 | ユーザー管理 | ✅ SCR-A02 | ✅ API-A02 | ✅ TICKET-03 完了 | **完全カバー** |
| REQ-A03 | ロール/権限管理 | ⚠️ SCR-A02 に含む | ⚠️ API-A02 に含む | ✅ TICKET-03 + FIX-05 | **実質カバー**（独立SCRなし） |

> **補足**: REQ-A03 はユーザー管理画面（SCR-A02）内のロール変更機能として実装されている。要件定義の `screens/index.md` では SCR-A03 を「ロール管理」として定義しているが、仕様書の SCR-A03 は「監査ログビューア」に割り当てられている（**採番の不整合**）。

### Epic B: ワークフロー（Must）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-B01 | 申請作成 | ✅ SCR-B02 | ✅ API-B02 | ✅ TICKET-08 完了 | **完全カバー** |
| REQ-B02 | 承認/差戻し | ✅ SCR-B03 | ✅ API-B03 | ✅ TICKET-09 完了 | **完全カバー** |
| REQ-B03 | 申請履歴/ステータス追跡 | ✅ SCR-B01 | ✅ API-B01 | ✅ TICKET-08 に含む | **完全カバー** |

### Epic C: 案件/タスク/工数（Must）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-C01 | プロジェクト管理 | ✅ SCR-C01-1, C01-2 | ✅ API-C01 | ✅ TICKET-04 完了 | **完全カバー** |
| REQ-C02 | タスク管理 | ✅ SCR-C02 | ✅ API-C02 | ✅ TICKET-05 完了 | **完全カバー** |
| REQ-C03 | 工数入力/集計 | ✅ SCR-C03-1, C03-2 | ✅ API-C03-1, C03-2 | ✅ TICKET-06, 07 完了 | **完全カバー** |

### Epic D: 経費（Should）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-D01 | 経費申請 | ✅ SCR-D01 | ✅ API-D01 | ✅ TICKET-10 完了 | **完全カバー** |
| REQ-D02 | 経費集計/レポート | ❌ SCR-D03 なし | ❌ API なし | ❌ 未実装 | **未着手** |

### Epic E: 請求（Should）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-E01 | 請求書管理 | ❌ なし | ❌ なし | ❌ 未実装 | **未着手（将来フェーズ）** |

> **注意**: `spec/screens/SCR-E01.md` は通知機能の画面仕様（REQ-G01 に対応）であり、請求の SCR-E01 ではない。`spec/apis/API-E01.md` も通知APIであり、請求の API-E01 ではない。**採番の不整合が発生している**。

### Epic F: ドキュメント（Could）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-F01 | ドキュメント管理 | ❌ SCR-F01 なし | ❌ API なし | ❌ 未実装 | **未着手（将来フェーズ）** |

### Epic G: 通知/検索/レポート（Could）

| REQ | 要件名 | SCR 仕様 | API 仕様 | 実装（TICKET） | 判定 |
|---|---|---|---|---|---|
| REQ-G01 | 通知 | ✅ SCR-E01※ | ✅ API-E01※ | ✅ TICKET-11 完了 | **実装済だが採番不整合** |
| REQ-G02 | 全文検索 | ❌ SCR-G02 なし | ❌ API なし | ❌ 未実装 | **未着手（将来フェーズ）** |
| REQ-G03 | ダッシュボード/レポート | ✅ SCR-002 | N/A | 🔲 TICKET-01 未着手 | **仕様あり・未実装** |

> ※ REQ-G01（通知）の仕様書は SCR-E01 / API-E01 として作成されている（Epic E の採番を使用）。

### カバレッジサマリ

| 判定 | 件数 | REQ |
|---|---|---|
| **完全カバー**（仕様+実装済） | 9 | A01, A02, B01, B02, B03, C01, C02, C03, D01 |
| **実質カバー**（独立仕様書なし） | 2 | A03, G01 |
| **仕様あり・未実装** | 1 | G03（ダッシュボード） |
| **未着手（将来機能）** | 4 | D02, E01, F01, G02 |
| **合計** | 14 REQ中 12 REQ カバー（86%） | — |

---

## 2. 未実装画面の分類

### 画面一覧 vs 仕様書ファイルの存在チェック

`requirements/screens/index.md` に定義された 21 画面について、`spec/screens/` にファイルが存在するかを確認した。

| 画面ID | 画面名 | REQ | 仕様書 | 実装 | 分類 |
|---|---|---|---|---|---|
| SCR-001 | ログイン | — | ✅ あり | ✅ | 実装済 |
| SCR-002 | ダッシュボード | REQ-G03 | ✅ あり | 🔲 未着手 | **今回スコープ（漏れ）** |
| SCR-A01 | テナント管理 | REQ-A01 | ✅ あり | ✅ | 実装済 |
| SCR-A02 | ユーザー管理 | REQ-A02 | ✅ あり | ✅ | 実装済 |
| SCR-A03 | ロール管理 | REQ-A03 | ⚠️ 監査ログに転用 | ⚠️ | 下記参照 |
| SCR-B01 | 申請一覧 | REQ-B03 | ✅ あり | ✅ | 実装済 |
| SCR-B02 | 申請作成 | REQ-B01 | ✅ あり | ✅ | 実装済 |
| SCR-B03 | 申請詳細/承認 | REQ-B02 | ✅ あり | ✅ | 実装済 |
| SCR-C01-1 | プロジェクト一覧 | REQ-C01 | ✅ あり | ✅ | 実装済 |
| SCR-C01-2 | プロジェクト詳細 | REQ-C01 | ✅ あり | ✅ | 実装済 |
| SCR-C02 | タスク管理 | REQ-C02 | ✅ あり | ✅ | 実装済 |
| SCR-C03-1 | 工数入力 | REQ-C03 | ✅ あり | ✅ | 実装済 |
| SCR-C03-2 | 工数集計 | REQ-C03 | ✅ あり | ✅ | 実装済 |
| SCR-D01 | 経費一覧 | REQ-D01 | ✅ あり | ✅ | 実装済 |
| **SCR-D02** | **経費申請** | REQ-D01 | ❌ なし | ⚠️ | **SCR-D01 に統合** |
| **SCR-D03** | **経費集計** | REQ-D02 | ❌ なし | ❌ | **将来フェーズ** |
| SCR-E01 | 請求一覧 | REQ-E01 | ❌ なし | ❌ | **将来フェーズ** |
| **SCR-E02** | **請求書作成/編集** | REQ-E01 | ❌ なし | ❌ | **将来フェーズ** |
| **SCR-F01** | **ドキュメント一覧** | REQ-F01 | ❌ なし | ❌ | **将来フェーズ** |
| **SCR-G01** | **通知一覧** | REQ-G01 | ⚠️ SCR-E01 で代替 | ✅ | **採番不整合**（実装済） |
| **SCR-G02** | **検索結果** | REQ-G02 | ❌ なし | ❌ | **将来フェーズ** |

### 詳細分析

#### SCR-D02（経費申請画面）・SCR-D03（経費集計画面）

| 画面 | 分析 |
|---|---|
| **SCR-D02** | 経費申請フォーム画面（`/expenses/new`）。要件では独立画面として定義されているが、仕様書では **SCR-D01 内の「画面② 経費申請（新規作成）」** として統合して記述されている。実装も完了済。**→ 定義漏れではなく統合設計**。ただし画面一覧との不整合あり。 |
| **SCR-D03** | 経費集計/レポート画面（`/expenses/summary`）。REQ-D02（経費集計/レポート）に対応する画面。Should 要件であり、**明示的にMust完了後に着手予定**（API一覧で「未着手」と記載）。**→ 将来フェーズ（意図的なスコープ外）** |

#### SCR-E02（請求書作成/編集画面）

- 請求書の作成・編集画面（`/invoices/[id]`）。REQ-E01（請求書管理）に対応。
- Should 要件であり、**仕様・実装ともに未着手**。
- **→ 将来フェーズ（意図的なスコープ外）**

#### SCR-F01（ドキュメント一覧画面）

- プロジェクトに紐づくドキュメント一覧（`/projects/[id]/docs`）。REQ-F01（ドキュメント管理）に対応。
- Could 要件であり、**仕様・実装ともに未着手**。
- **→ 将来フェーズ（意図的なスコープ外）**

#### SCR-G01（通知一覧）・SCR-G02（検索結果）

| 画面 | 分析 |
|---|---|
| **SCR-G01** | 通知一覧画面（`/notifications`）。REQ-G01（通知）に対応。**実装済だが、仕様書は SCR-E01 として作成されている**（`spec/screens/SCR-E01.md` = 通知のNotificationBell画面仕様）。実装はヘッダーの Popover 方式であり、独立した `/notifications` ページとしてではなく `NotificationBell` コンポーネントとして実装されている。**→ 採番不整合 + 画面形態の変更（独立ページ → ヘッダー組込 Popover）** |
| **SCR-G02** | 検索結果画面（`/search`）。REQ-G02（全文検索）に対応。Could 要件であり、**仕様・実装ともに未着手**。**→ 将来フェーズ（意図的なスコープ外）** |

### 追加された画面（要件定義に未記載）

| 画面ID | 画面名 | REQ | 仕様書 | 実装 | 備考 |
|---|---|---|---|---|---|
| SCR-A03 | 監査ログビューア | NFR-05 | ✅ あり | ✅ TICKET-12 | 要件定義 `screens/index.md` の「未決事項」に「監査ログ閲覧画面の追加」と記載あり。仕様・実装済だが画面一覧の本表に未反映 |

### 分類サマリ

| 分類 | 画面数 | 対象 |
|---|---|---|
| 実装済 | 14 | SCR-001, 002を除く Must + SCR-D01 + 通知 + 監査ログ |
| 仕様統合 | 1 | SCR-D02（SCR-D01に統合） |
| 将来フェーズ | 5 | SCR-D03, E01, E02, F01, G02 |
| 採番不整合 | 1 | SCR-G01 → SCR-E01 として作成 |
| 仕様あり未実装 | 1 | SCR-002（ダッシュボード / TICKET-01） |

---

## 3. NFR リスク評価表

### NFR カバレッジ一覧

| NFR | 要件 | 設計での対応 | 実装での対応 | リスク |
|---|---|---|---|---|
| **NFR-01a** | 認証（Supabase Auth） | ✅ authz/index.md で方針記述 | ✅ `requireAuth()` / Middleware 実装済 | 🟢 低 |
| **NFR-01b** | 認可（RBAC + RLS） | ✅ authz/index.md + detail/rls/ | ✅ `requireRole()` / `hasRole()` + RLS実装済 | 🟢 低 |
| **NFR-01c** | テナント分離 | ✅ ADR-0003 + RLS設計 | ✅ 全テーブルに `tenant_id` RLS | 🟢 低 |
| **NFR-01d** | パスワードポリシー | ⚠️ 明示的な設計文書なし | ⚠️ Supabase Auth デフォルト依存 | 🟡 中 |
| **NFR-01e** | HTTPS通信 | ❌ 設計文書なし | ⚠️ デプロイ環境依存（未検証） | 🟡 中 |
| **NFR-01f** | CSRF/XSS対策 | ❌ 設計文書なし | ⚠️ Next.js 組込み依存（CSP未設定） | 🟡 中 |
| **NFR-01g** | SQLインジェクション防止 | ⚠️ supabase-client 規約に記載 | ✅ Supabase SDK パラメータ化 | 🟢 低 |
| **NFR-02a** | ページ応答時間 | ⚠️ Server Component 方針のみ | ⚠️ 計測・検証未実施 | 🟡 中 |
| **NFR-02b** | API応答時間 | ❌ 設計文書なし | ❌ 計測・検証未実施 | 🟡 中 |
| **NFR-02c** | 同時接続 | ❌ 設計文書なし | ❌ 負荷テスト未実施 | 🔴 高 |
| **NFR-02d** | データ量 | ❌ 設計文書なし | ❌ インデックス設計以外未対応 | 🟡 中 |
| **NFR-02e** | 検索性能 | ❌ ADR-0005 未作成 | ❌ 全文検索機能自体が未実装 | 🟡 中（将来機能） |
| **NFR-03a** | 稼働率 | ❌ 設計文書なし | ❌ SLA未設定（Supabase依存） | 🟡 中 |
| **NFR-03b** | バックアップ | ❌ 設計文書なし | ⚠️ Supabase 標準機能に依存 | 🟡 中 |
| **NFR-03c** | リカバリ | ❌ 設計文書なし | ❌ RPO/RTO 検証未実施 | 🔴 高 |
| **NFR-04a** | ログ（JSON構造化） | ❌ 設計文書なし | ❌ 構造化ログ未実装（console.error のみ） | 🔴 高 |
| **NFR-04b** | 監視（ヘルスチェック） | ❌ 設計文書なし | ❌ `/api/health` 未実装 | 🟡 中 |
| **NFR-04c** | マイグレーション | ⚠️ ADR-0005（Supabase CLI） | ✅ Supabase Migrations 運用中 | 🟢 低 |
| **NFR-04d** | ゼロダウンタイムデプロイ | ❌ 設計文書なし | ❌ デプロイ方針未策定 | 🟡 中 |
| **NFR-05a** | 監査ログ記録 | ✅ audit-logging/index.md | ✅ `writeAuditLog()` 全操作実装済 | 🟢 低 |
| **NFR-05b** | 監査ログ内容 | ✅ audit-logging/index.md | ✅ who/when/what/before/after 記録済 | 🟢 低 |
| **NFR-05c** | 保持期間 | ⚠️ 方針記載あり（1年） | ❌ 削除ポリシー・パーティション未実装 | 🟡 中 |
| **NFR-05d** | 改ざん防止 | ✅ INSERT ONLY 方針 | ✅ RLS で UPDATE/DELETE 禁止 | 🟢 低 |
| **NFR-06a** | レスポンシブ | ⚠️ Ant Design 依存 | ⚠️ 明示的なレスポンシブ検証なし | 🟡 中 |
| **NFR-06b** | ブラウザ対応 | ❌ 設計文書なし | ⚠️ 検証未実施 | 🟡 中 |
| **NFR-06c** | アクセシビリティ | ❌ 設計文書なし | ❌ WCAG 準拠未検証 | 🟡 中 |
| **NFR-06d** | 日本語のみ | N/A | ✅ 暗黙的に日本語 | 🟢 低 |

### 高リスク NFR（要対応）

| NFR | リスク理由 | 推奨アクション |
|---|---|---|
| **NFR-02c** 同時接続 | 100ユーザー同時アクセスの要件に対し、負荷テスト計画も実施もなし。本番障害のリスク大 | 負荷テスト計画の策定 + Supabase の接続プーリング設定確認 |
| **NFR-03c** リカバリ | RPO 24時間・RTO 4時間の要件に対し、リカバリ手順が未文書化。障害発生時の復旧遅延リスク | DR 手順書の作成 + 復旧訓練の実施 |
| **NFR-04a** 構造化ログ | 本番運用でログ追跡が困難。現状は `console.error` のみで、JSON 構造化・レベル分類なし | ロギングライブラリの導入（pino 等）+ 構造化ログ設計 |

### NFR カバレッジサマリ

| レベル | 件数 | 割合 |
|---|---|---|
| 🟢 低リスク（設計+実装済） | 10 | 37% |
| 🟡 中リスク（部分対応 or 未検証） | 14 | 52% |
| 🔴 高リスク（未対応 + 影響大） | 3 | 11% |

---

## 4. ロール × 機能の権限マトリクス

### 要件定義（roles/index.md）vs 実装の照合

#### 実装済み機能の権限マトリクス

| 機能 | Member | Approver | PM | Accounting | TenantAdmin | ITAdmin | 仕様書での定義 | 実装の整合性 |
|---|:---:|:---:|:---:|:---:|:---:|:---:|---|---|
| ダッシュボード | 自分 | 自分+承認 | PJ全体 | 経費 | テナント | 全体 | SCR-002 | ⚠️ 未実装 |
| WF申請作成 | ✅ | — | ✅ | ✅ | ✅ | — | SCR-B02 / API-B02 | ✅ 整合 |
| WF承認/差戻し | — | ✅ | — | — | ✅ | — | SCR-B03 / API-B03 | ✅ 整合 |
| PJ管理 | 閲覧 | 閲覧 | ✅CRUD | 閲覧 | ✅CRUD | 閲覧 | SCR-C01 / API-C01 | ✅ 整合 |
| タスク管理 | 自分 | 閲覧 | ✅CRUD | — | ✅CRUD | — | SCR-C02 / API-C02 | ✅ 整合 |
| 工数入力 | ✅自分 | ✅自分 | ✅自分+閲覧 | — | — | — | SCR-C03 / API-C03 | ✅ 整合 |
| 経費申請 | ✅自分 | — | ✅自分 | — | — | — | SCR-D01 / API-D01 | ✅ 整合 |
| 経費閲覧（全件） | — | — | — | ✅ | ✅ | — | SCR-D01 / API-D01 | ✅ 整合 |
| 通知 | ✅自分 | ✅自分 | ✅自分 | ✅自分 | ✅自分 | ✅自分 | SCR-E01 / API-E01 | ✅ 整合 |
| 監査ログ | — | — | — | — | ✅閲覧 | ✅閲覧 | SCR-A03 | ✅ 整合 |
| ユーザー管理 | — | — | — | — | ✅ | ✅ | SCR-A02 / API-A02 | ✅ 整合 |
| テナント管理 | — | — | — | — | — | ✅ | SCR-A01 / API-A01 | ✅ 整合 |

#### 新規追加機能のロール制御状況

| 機能 | ロール制御の仕様化 | ロール制御の実装 | 詳細 |
|---|---|---|---|
| **経費管理**（TICKET-10） | ✅ SCR-D01 + API-D01 に明記 | ✅ 実装済 | Member/PM は自分の経費のみ、Accounting/TenantAdmin は全件閲覧。RLS でも制御 |
| **通知**（TICKET-11） | ✅ SCR-E01 + API-E01 に明記 | ✅ 実装済 | 全ロール共通（自分の通知のみ）。RLS `user_id = auth.uid()` で制御 |
| **監査ログ**（TICKET-12） | ✅ SCR-A03 に明記 | ✅ 実装済 | IT Admin / Tenant Admin のみ。`hasRole()` + RLS で二重チェック |

### 未実装機能のロール制御状況

| 機能 | 要件定義のロール | 仕様化 | リスク |
|---|---|---|---|
| 経費集計（REQ-D02） | Accounting, PM | ❌ 未仕様化 | 🟡 将来実装時に要設計 |
| 請求管理（REQ-E01） | Accounting, PM（閲覧）, TenantAdmin | ❌ 未仕様化 | 🟡 将来実装時に要設計 |
| ドキュメント管理（REQ-F01） | Member, PM（CRUD）, Accounting（閲覧）, TenantAdmin | ❌ 未仕様化 | 🟡 将来実装時に要設計 |
| 全文検索（REQ-G02） | 全員 | ❌ 未仕様化 | 🟢 低（全員アクセス可） |
| ダッシュボード（REQ-G03） | 全員（ロール別表示） | ✅ SCR-002 に記載 | 🟡 TICKET-01 未着手 |

---

## 5. 検出された問題と推奨アクション

### 問題一覧

| # | 種別 | 重大度 | 問題 | 推奨アクション |
|---|---|---|---|---|
| GAP-01 | 採番不整合 | 🟡 中 | 通知機能が SCR-E01 / API-E01 として作成されているが、要件定義では E = 請求、G01 = 通知 | 採番ルールの見直し、または画面一覧の更新 |
| GAP-02 | 採番不整合 | 🟡 中 | SCR-A03 が要件定義では「ロール管理」、仕様書では「監査ログビューア」 | 画面一覧にロール管理の記載を SCR-A02 統合と明記し、SCR-A03 を監査ログとして正式登録 |
| GAP-03 | 画面統合未反映 | 🟢 低 | SCR-D02（経費申請）が SCR-D01 に統合されたが、画面一覧に未反映 | 画面一覧を更新し、統合の旨を注記 |
| GAP-04 | 画面一覧未更新 | 🟢 低 | 監査ログビューア（SCR-A03）が画面一覧の本表に未追加（「未決事項」のみ） | 画面一覧の本表に追加 |
| GAP-05 | 未実装（スコープ内） | 🔴 高 | TICKET-01 ダッシュボード（Must画面、SCR-002）が未着手 | 優先的に実装着手 |
| GAP-06 | NFR 未対応 | 🔴 高 | NFR-04a 構造化ログ、NFR-02c 負荷テスト、NFR-03c DR手順が未対応 | 運用開始前に対応必須 |
| GAP-07 | 仕様一覧未更新 | 🟡 中 | `spec/screens/index.md` と `spec/apis/index.md` に SCR-D01, SCR-E01, SCR-A03, API-D01, API-E01 が未掲載 | 仕様一覧ファイルの更新 |
| GAP-08 | 将来機能未文書化 | 🟢 低 | REQ-D02, E01, F01, G02 が「将来フェーズ」であることが散在的にしか記載されていない | フェーズ計画を明示的に文書化 |

### 優先度別アクション

#### 即時対応（Must）
1. **GAP-05**: TICKET-01（ダッシュボード）の実装着手
2. **GAP-06**: NFR 高リスク項目の対応計画策定

#### 次フェーズ（Should）
3. **GAP-01, GAP-02**: 採番不整合の是正（画面一覧・仕様一覧の更新）
4. **GAP-07**: 仕様一覧ファイル（`spec/screens/index.md`, `spec/apis/index.md`）の更新

#### 任意（Could）
5. **GAP-03, GAP-04, GAP-08**: ドキュメントの整合性改善

---

## 6. 総合評価

| 観点 | 評価 | コメント |
|---|---|---|
| Must 要件カバレッジ | **95%** | 9/9 REQ 実装完了。ダッシュボード（Must画面）のみ未着手 |
| Should 要件カバレッジ | **50%** | REQ-D01 実装済、REQ-D02/E01 未着手（意図的） |
| Could 要件カバレッジ | **33%** | REQ-G01（通知）実装済、G02/F01 未着手（意図的） |
| NFR カバレッジ | **37%** | セキュリティ・監査は充実、性能・可用性・運用は要対応 |
| ロール権限の仕様化 | **良好** | 実装済み機能は全て権限仕様が文書化・実装されている |
| ドキュメント整合性 | **要改善** | 採番不整合、仕様一覧の未更新が複数箇所に存在 |
