---
title: 非機能要件（NFR）
description: セキュリティ・性能・可用性・運用・監査の要件
---

## 目的 / In-Out / Related
- **目的**: 機能以外の品質要件を明記し、設計・テストの基準とする
- **対象範囲（In）**: セキュリティ、性能、可用性、運用、監査
- **対象範囲（Out）**: SLA保証値の合意（運用フェーズ）
- **Related**: [REQカタログ](../req-catalog/) / [ADR-0001](../../adr/adr-0001/) / [ADR-0003](../../adr/adr-0003/)

---

## NFR-01 セキュリティ

| # | 要件 | 基準 |
|---|---|---|
| NFR-01a | 認証 | Supabase Auth（email/password）。セッション有効期限 1時間、リフレッシュ対応 |
| NFR-01b | 認可 | RBAC + RLS。全業務テーブルにRLSを強制（ADR-0001） |
| NFR-01c | テナント分離 | tenant_id + RLS。テナント間データアクセスは不可能（ADR-0003） |
| NFR-01d | パスワード | 8文字以上、英数字混在。Supabase Authデフォルトポリシー準拠 |
| NFR-01e | 通信 | HTTPS必須。開発環境含めTLS |
| NFR-01f | CSRF/XSS | Next.js組み込み + CSP設定。サーバーサイドレンダリング中心で軽減 |
| NFR-01g | SQLインジェクション | Supabase Client SDK（パラメータ化クエリ）で防止 |

## NFR-02 性能

| # | 要件 | 基準 |
|---|---|---|
| NFR-02a | ページ応答時間 | 主要画面のTTFBは 200ms以下（Server Component） |
| NFR-02b | API応答時間 | 95パーセンタイルで 500ms以下 |
| NFR-02c | 同時接続 | テナントあたり 100ユーザー同時アクセスに耐える |
| NFR-02d | データ量 | テナントあたり 10万レコード/テーブルまでの性能を保証 |
| NFR-02e | 検索 | 全文検索は 1秒以内（ADR-0005で方式決定） |

## NFR-03 可用性

| # | 要件 | 基準 |
|---|---|---|
| NFR-03a | 稼働率 | 99.5%以上（月間ダウンタイム 3.6時間以内） |
| NFR-03b | バックアップ | PostgreSQL日次バックアップ。7日分保持 |
| NFR-03c | リカバリ | RPO: 24時間、RTO: 4時間 |

## NFR-04 運用・保守

| # | 要件 | 基準 |
|---|---|---|
| NFR-04a | ログ | アプリログはJSON構造化。error/warn/info レベル |
| NFR-04b | 監視 | ヘルスチェックエンドポイント `/api/health` |
| NFR-04c | マイグレーション | Supabase Migrations。ロールバック可能な設計 |
| NFR-04d | デプロイ | ゼロダウンタイムデプロイ（Docker rollout） |

## NFR-05 監査

| # | 要件 | 基準 |
|---|---|---|
| NFR-05a | 監査ログ | 主要操作（CRUD + 承認/差戻し）を記録（ADR-0002） |
| NFR-05b | 監査ログ内容 | who（user_id）/ when（timestamp）/ what（action + resource）/ before / after |
| NFR-05c | 保持期間 | 最低1年。法的要件に応じて延長 |
| NFR-05d | 改ざん防止 | 監査ログテーブルは INSERT ONLY（UPDATE/DELETE禁止） |

## NFR-06 ユーザビリティ

| # | 要件 | 基準 |
|---|---|---|
| NFR-06a | レスポンシブ | PC（1280px以上）を主軸。タブレット対応。スマホは閲覧のみ |
| NFR-06b | ブラウザ | Chrome/Edge/Safari 最新2バージョン |
| NFR-06c | アクセシビリティ | WCAG 2.1 AA 準拠を目標 |
| NFR-06d | 言語 | 日本語のみ（i18n対応は将来） |

---

## 未決事項
- NFR-02c の同時接続数はテナント規模に応じてスケーリング戦略を要検討
- NFR-05c の法的要件は業界ごとに異なるため、導入時に確認

## 次アクション
- 基本設計で各 SPEC に該当 NFR を紐付ける
- 詳細設計でテスト方針に NFR のテスト項目を含める
