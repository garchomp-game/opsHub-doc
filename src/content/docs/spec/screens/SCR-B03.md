---
title: SPEC-SCR-B03 申請詳細/承認
description: 申請の詳細表示と承認/差戻し操作の画面仕様
---

## 目的 / In-Out / Related
- **目的**: 申請の詳細を確認し、承認者が承認/差戻しを行う
- **対象範囲（In/Out）**: 詳細表示・承認・差戻し・取下げ・コメント
- **Related**: REQ-B02 / SPEC-API-B03 / DD-DB-workflows

## 画面情報
- **画面ID**: SPEC-SCR-B03
- **画面名**: 申請詳細/承認
- **対象ロール**: 全ロール（操作権限はロールで制御）
- **URL**: `/workflows/[id]`
- **状態**: Draft

## 主要ユースケース
- 申請者: 自分の申請の詳細・ステータスを確認する。差戻し後に再申請する
- 承認者: 申請内容を確認し、承認または差戻し（理由付き）を行う

## UI構成（概要）
- **ヘッダー**: 申請番号、ステータスバッジ、申請種別
- **詳細セクション**: タイトル、説明、金額等（種別に応じた表示）
- **添付ファイル**: サムネイル/リスト表示、ダウンロード
- **タイムライン**: 作成→送信→承認/差戻しの履歴
- **アクションバー**:
  - 申請者: 「取下げ」（申請中のみ）/「再申請」（差戻し時）
  - 承認者: 「承認」/「差戻し」（差戻し理由テキストエリア）

## 振る舞い・遷移
- 承認: 確認ダイアログ → 承認 → ステータス変更 → 申請者に通知 → 一覧へ戻る
- 差戻し: 理由入力（必須）→ 差戻し → ステータス変更 → 申請者に通知
- 取下げ: 確認ダイアログ → 取下げ → ステータス変更
- 権限エラー時: 操作ボタンが非表示（UIレベル）+ RLSで二重防御

## エラー/例外
- 既に承認/差戻し済み: 「この申請は既に処理されています」→ 再読込
- 差戻し理由未入力: 「差戻し理由を入力してください」

## 監査ログポイント
- `workflow.approve`: 承認時（before: status=submitted, after: status=approved）
- `workflow.reject`: 差戻し時（理由を metadata に記録）
- `workflow.withdraw`: 取下げ時
- `workflow.resubmit`: 再申請時

## 関連リンク
- Related: REQ-B02 / SPEC-SCR-B01 / SPEC-API-B03
